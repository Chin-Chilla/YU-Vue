<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--<script th:src="@{/javascript/common/vue/vue.js}"  type="text/javascript"></script>-->
    <!--<link rel="stylesheet" th:href="@{/resources/css/index.css}"/>-->
    <title>数据连接管理</title>
</head>
<body>
    <div class="row">
        <div class="col-md-12">
            <!-- Horizontal Form -->
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">添加搜索条件</h3>
                </div>
                <!-- form start -->
                <form class="form-horizontal">
                    <div class="box-body" style="width:970px">
                        <div style="margin-right:0px">
                            <div class="form-group">
                                <label  class="col-sm-1 control-label" style="min-width: 120px">数据库名&nbsp;&nbsp;</label>

                                <div class="col-sm-2">
                                    <input type="text" class="form-control" id="dbname">
                                </div>
                                <label class="col-sm-1 control-label" style="min-width: 120px">数据库中文名&nbsp;&nbsp;</label>

                                <div class="col-sm-2">
                                    <input type="text" class="form-control" id="dbcnname">
                                </div>
                                <label class="col-sm-1 control-label" style="min-width: 120px">联系人名&nbsp;&nbsp;</label>

                                <div class="col-sm-2">
                                    <input type="text" class="form-control" id="contacts">
                                </div>
                            </div>
                            <div class="form-group">

                                <label class="col-sm-1 control-label" style="min-width: 120px">联系单位&nbsp;&nbsp;</label>

                                <div class="col-sm-2">
                                    <input type="text" class="form-control" id="company">
                                </div>

                                <!-- Date and time range -->

                                <label class="col-sm-1 control-label" style="min-width: 120px">起始时间&nbsp;&nbsp;</label>
                                <div class="col-sm-2">
                                    <input id="startTime" type="text" readonly class="form-control datepicker">
                                </div>

                                <label class="col-sm-1 control-label" style="min-width: 120px">截止时间&nbsp;&nbsp;</label>
                                <div class="col-sm-2">
                                    <input id="endTime" type="text" readonly class="form-control datepicker">
                                </div>
                            </div>
                        </div>
                        <!-- /.form group -->
                    </div>
                    <!-- /.box-body -->
                    <div class="row" style="width:970px">
                        <div class="box-footer" >

                            <div class="pull-right" style="margin-right:130px">
                                <nobr><input type="button" value="提交" permission="ss" class="PER_BTN btn btn-info "  onClick="DataManage.loadSpecificTable()">
                                    <input type="button" value="重置" permission="ss" class="PER_BTN btn btn-default "  onClick="DataManage.reset()">

                                </nobr>
                            </div>


                        </div>
                    </div>
                    <!-- /.box-footer -->
                </form>
            </div>
        </div>
        <div class="row" style= "margin-top:10px">
            <div class="pull-right" style="margin-right:20px;">
                <div class="btn-group">
                <input type="button" value="生成文件" permission="ss" class="PER_BTN btn btn-block btn-primary" id="generate"  onclick="DataManage.generate()">
            </div>
                <div class="btn-group">
                    <input type="button" value="新建" permission="ss" class="PER_BTN btn btn-block btn-primary" data-toggle="modal" data-target="#exampleModal">
                </div>
                <div class="btn-group">
                    <input type="button" value="编辑" permission="ss" class="PER_BTN btn btn-block btn-primary" id="edit">
                </div>
                <div class="btn-group">
                    <input type="button" value="删除" permission="ss" class="PER_BTN btn btn-block btn-primary" onclick="DataManage.deleteDataBase()">
                </div>

                <!--<div class="btn-group">
                    <input type="button" value="编目" permission="ss" class="PER_BTN btn btn-block btn-primary"  onclick="DataManage.deleteDBMD()">
                </div>-->
                <!--<div class="btn-group">
                                <button type="button" class="btn btn-block btn-primary"onclick="DataManage.updateTable()">更新表</button>
                            </div>-->
                <div class="btn-group">
                    <input type="button" value="测试" permission="ss" class="PER_BTN btn btn-block btn-primary" onclick="DataManage.testConnect()">
                </div>
                <div class="btn-group">
                    <input type="button" value="抽取" permission="ss" class="PER_BTN btn btn-block btn-primary"onclick="DataManage.extractTable()">
                </div>
                <div class="btn-group">
                    <input type="button" value="查看" permission="ss" class="PER_BTN btn btn-block btn-primary" onclick="DataManage.seeDataTable()">
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-block btn-primary"  onclick="DataManage.showCatalogModal('isChecked2')">编目元数据</button>
                </div>

            </div>
        </div>
    </div>
    <!-- /.box-body -->

    <div class="col-md-12">
        <div class="box box-primary" id="attribute-box">
            <div id="loading" class="overlay" style="display:none;"><i class="fa fa-refresh fa-spin"></i></div>
            <div class="box-body" style="overflow-x:scroll;">
                <div id="dbConnInfo_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
                    <div class="row">
                        <div class="col-sm-12">
                            <table id="dbConnInfoList" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="catalogNodeList_info">
                                <thead>
                                    <tr role="row">
                                        <th  tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1"><input type='checkbox' class='checkbox' name='allChecked'/></th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">ID</th>
                                        <th class="sorting_desc" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">数据库名称</th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">数据库SID</th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">数据库描述</th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">表数量</th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">数据量</th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">更新时间</th>
                                        <th class="sorting" tabindex="0"  aria-controls="dbConnInfoList" rowspan="1" colspan="1">测试连接</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="db_info:${db_infos.db}" role="row" class="odd">
                                        <td><input type='checkbox' class='checkbox' name='singleChecked'/></td>
                                        <td th:text="${db_info.src_id}"></td>
                                        <td th:text="${db_info.dataBase.db_c_nname}"></td>
                                        <td th:text="${db_info.src_sid}"></td>
                                        <td th:text="${db_info.dataBase.db_desc!=null ? db_info.dataBase.db_desc:''}"></td>
                                        <td th:text="${db_info.dataBase.table_num!=null?db_info.dataBase.table_num:''}"></td>
                                        <td th:text="${db_info.dataBase.data_size!=null?db_info.dataBase.data_size:''}"></td>
                                        <td th:text="${db_info.dataBase.update_time!=null?db_info.dataBase.update_time:''}"></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- 表格分页器由 adminLTE 加载 -->
                </div>
            </div>

        </div>

        <!--新建数据库连接模态框-->
        <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog" role="document" style="height:400px">
                <div class="modal-content" >
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">编辑数据库连接</h4>
                    </div>
                    <div class="modal-body" >
                        <div class="box box-primary" style="height:400px;overflow-x:hidden;margin:10px 0px 0px 0px">
                            <form>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="DBtype2" >数据库类型</label>
                                            <select  class="form-control" id="DBtype2">
                                                <option value="Oracle">Oracle</option>
                                                <option value="DM">DM</option>
                                                <option value="MYSQL">MYSQL</option>
                                                <option value="SQLServer">SQLServer</option>
                                            </select>
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="DBtype3">*(必填)</p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="databasechinesename" class="control-label">数据库中文名</label>
                                            <input type="text" class="form-control" id="databasechinesename" onblur="DataManage.checkdatabase_chinesename('databasechinesename','databasechinesename_info')" placeholder="请填写数据库中文名称！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="databasechinesename_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="database_sid" class="control-label">数据库SID</label>
                                            <input type="text" class="form-control" id="database_sid" onblur="DataManage.checkdatabaseSid('database_sid','database_sid_info')"placeholder="请填写数据库SID！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="database_sid_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="IPaddr" class="control-label">IP地址</label>
                                            <input type="text" class="form-control" id="IPaddr" onblur="DataManage.checkIP('IPaddr','IPaddr_info')" placeholder="请填写IP地址！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="IPaddr_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="portnum" class="control-label">端口</label>
                                            <input type="text" class="form-control" id="portnum" onblur="DataManage.checkport('portnum','portnum_info')" placeholder="请填写端口号！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="portnum_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="user_name" class="control-label">用户名</label>
                                            <input type="text" class="form-control" id="user_name" onblur="DataManage.checkusername('user_name','user_name_info')" placeholder="请填写用户名！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="user_name_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="pwd" class="control-label">密码</label>
                                            <input type="password" class="form-control" id="pwd" onblur="DataManage.checkpassword('pwd','pwd_info')" placeholder="请填写密码！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="key_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="editDepartment" class="control-label">数据源所属单位</label>
                                            <input type="text" class="form-control" readonly id="editDepartment" >
                                            <button type="button" class="btn btn-block btn-primary" onclick="DataManage.showEditDpModel()">更改单位</button>
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="editDepartment_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="dbdesc" class="control-label">数据库描述</label>
                                            <input type="text" class="form-control" id="dbdesc" placeholder="请填写数据库描述！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="dbdesc_info">*(必填)
                                    </p>
                                </div>
                            </form>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" onclick="DataManage.save_edit()">保存</button>
                        <button type="button" class="btn btn-primary" onclick="DataManage.testConnect()">测试</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog" role="document" style="height:400px">
                <div class="modal-content">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="exampleModalLabel1">新建数据库连接</h4>
                        </div>
                        <div class="modal-body">
                            <div class="box box-primary" style="height:400px;overflow-x:hidden;margin:10px 0px 0px 0px">
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="DBtype" >数据库类型</label>
                                            <select  class="form-control" id="DBtype">
                                                <option value="Oracle">Oracle</option>
                                                <option value="DM">DM</option>
                                                <option value="MYSQL">MYSQL</option>
                                                <option value="SQLServer">SQLServer</option>
                                            </select>
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="DBtype1">*(必填)</p>
                                </div>

                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="database_chinesename" class="control-label">数据库中文名</label>
                                            <input type="text" class="form-control" id="database_chinesename" onblur="DataManage.checkdatabase_chinesename('database_chinesename','database_chinesename_info')" placeholder="请填写数据库中文名称！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="database_chinesename_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="databaseSid" class="control-label">数据库SID</label>
                                            <input type="text" class="form-control" id="databaseSid" onblur="DataManage.checkdatabaseSid('databaseSid','databaseSid_info')" placeholder="请填写数据库SID！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="databaseSid_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="IP" class="control-label">IP地址</label>
                                            <input type="text" class="form-control" id="IP" onblur="DataManage.checkIP('IP','IP_info')" placeholder="请填写IP地址！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="IP_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="port" class="control-label">端口</label>
                                            <input type="text" class="form-control" id="port" onblur="DataManage.checkport('port','port_info')" placeholder="请填写端口号！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="port_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="username" class="control-label">用户名</label>
                                            <input type="text" class="form-control" id="username" onblur="DataManage.checkusername('username','username_info')" placeholder="请填写用户名！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="username_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="password" class="control-label">密码</label>
                                            <input type="password" class="form-control" id="password" onblur="DataManage.checkpassword('password','password_info')" placeholder="请填写密码！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="password_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="department" class="control-label">数据源所属单位</label>
                                            <input type="text" class="form-control" readonly id="department"  placeholder="请选择所属单位！">
                                            <button type="button" class="btn btn-block btn-primary" onclick="DataManage.showSelectDpModel()">选择单位</button>
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="department_info">*(必填)
                                    </p>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-xs-7">
                                            <label for="database_describe" class="control-label">数据库描述</label>
                                            <input type="text" class="form-control" id="database_describe" placeholder="请填写数据库描述！">
                                        </div>
                                    </div>
                                    <p class="help-block" style="line-height:50px" id="database_describe_info">
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="button" class="btn btn-primary" id="save_changes" onclick="DataManage.save_edit()">保存</button>
                            <button type="button" class="btn btn-primary" onclick="DataManage.testConnects()">测试</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!--编目模态框-->
        <div class="modal fade" id="modelTree" tabindex="-1" role="dialog" aria-labelledby="">
            <div class="modal-dialog" role="document" style="width: 450px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" ><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">编目节点选择</h4>
                    </div>
                    <div class="modal-body">
                        <div class="ztree">
                            <ul id="addTree" style="height: 500px; overflow: auto; -moz-user-select: none;"></ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" value="确认" class="btn btn-primary" onclick="DataManage.catalogMetadata()">
                        <input type="button" value="取消" class="btn btn-default" data-dismiss="modal">
                    </div>
                </div>
            </div>
        </div>
        <!--新增2017.10.21-->


        <div class="modal fade" id="modelTree2" tabindex="-1" role="dialog" aria-labelledby="">
            <div class="modal-dialog" role="document" style="width: 450px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" ><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">编目节点选择</h4>
                    </div>
                    <div class="modal-body">
                        <div class="ztree">
                            <ul id="addTree2" style="height: 500px; overflow: auto; -moz-user-select: none;"></ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" value="确认" class="btn btn-primary" onclick="DataManage.catalogDataBase()">
                        <input type="button" value="取消" class="btn btn-default" data-dismiss="modal">
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modelTree3" tabindex="-1" role="dialog" aria-labelledby="">
            <div class="modal-dialog" role="document" style="width: 450px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" ><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">选择单位</h4>
                    </div>
                    <div class="modal-body">
                        <div class="ztree">
                            <ul id="addTree3" style="height: 500px; overflow: auto; -moz-user-select: none;"></ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" value="确认" class="btn btn-primary" onclick="DataManage.selectDp()">
                        <input type="button" value="取消" class="btn btn-default" data-dismiss="modal">
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modelTree4" tabindex="-1" role="dialog" aria-labelledby="">
            <div class="modal-dialog" role="document" style="width: 450px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" ><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">选择单位</h4>
                    </div>
                    <div class="modal-body">
                        <div class="ztree">
                            <ul id="addTree4" style="height: 500px; overflow: auto; -moz-user-select: none;"></ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" value="确认" class="btn btn-primary" onclick="DataManage.EditDp()">
                        <input type="button" value="取消" class="btn btn-default" data-dismiss="modal">
                    </div>
                </div>
            </div>
        </div>

    </div>
</body>

<script>
    $(function() {
        //全选复选框
        $('table th input:checkbox').on('click' , function(){
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
                .each(function(){
                    this.checked = that.checked;
                    $(this).closest('tr').toggleClass('selected');
                });

        });

        //重写enforceFocus方法是select2下拉搜索框可以在模态框中使用，否则select中的input框无法获得焦点
        $.fn.modal.Constructor.prototype.enforceFocus = function() {};

        //初始化select2搜索框
        $(".select2").select2({
            placeholder:"请搜索"
        });
        // DataManage.addCharger();

        //启用日期控件
        $('.datepicker').datepicker({
            autoclose: true,
            todayHighlight: true,
            language:"zh-CN"
        });


    });
</script>
<script>
    $(function () {
        //$("#catalogNodeList").DataTable();  // 动态加载
        $('#dbConnInfoList').DataTable({
            "paging": true,                 // 分页器
            "lengthChange": true,          // 列表显示长度
            "searching": true,             // 搜索框
            "ordering": true,             // 按列排序
            "info": false,                  // 当前显示记录的位置（左下角）
            "autoWidth": false             // 自动调整列宽
        });
    });
</script>
</html>